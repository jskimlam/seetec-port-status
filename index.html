<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš¢ ëŒ€ì‚°í•­ Seetec í¬íŠ¸ í˜„í™©íŒ</title>
    <!-- Google Fonts: í•­ë§Œ/ì‚°ì—…ìš© ëŠë‚Œì˜ í°íŠ¸ ì¡°í•© -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* â”€â”€ CSS ë³€ìˆ˜ : í•´êµ° ë¸”ë£¨ + í™”ì´íŠ¸ í…Œë§ˆ â”€â”€ */
        :root {
            --bg:           #e8eef4;        /* ì—°í•œ ë¸”ë£¨-ê·¸ë ˆì´ ë°°ê²½ */
            --surface:      #ffffff;        /* ì¹´ë“œ: ìˆœë°± */
            --surface2:     #f0f4f8;        /* ë³´ì¡° ë°°ê²½: ì•„ì´ìŠ¤ ë¸”ë£¨ */
            --navy:         #1b3a5c;        /* í•´êµ° ë¸”ë£¨ (í—¤ë”) */
            --navy-dark:    #122841;        /* í—¤ë” ê·¸ë¼ë””ì–¸íŠ¸ ë */
            --navy-mid:     #24527a;        /* í—¤ë” ì¤‘ê°„ */
            --border:       #ccd8e6;        /* ê²½ê³„ì„ : ìŠ¤í‹¸ ë¸”ë£¨ */
            --open:         #18a558;        /* ì˜¤í”ˆ: ì„ ëª… ë…¹ìƒ‰ */
            --closed:       #d63031;        /* í´ë¡œì§•: ì„ ëª… ë¹¨ê°• */
            --heavy:        #a00000;        /* í—¤ë¹„ í´ë¡œì§•: ì§„ë¹¨ */
            --none:         #e4ecf4;        /* ë°ì´í„° ì—†ìŒ: ì—°ë¸”ë£¨ */
            --text:         #1a2a3a;        /* ê¸°ë³¸ í…ìŠ¤íŠ¸: ë‹¤í¬ ë„¤ì´ë¹„ */
            --text-muted:   #5a7a9a;        /* ë³´ì¡° í…ìŠ¤íŠ¸: ë¯¸ë””ì—„ ë¸”ë£¨ */
            --accent:       #1565c0;        /* í¬ì¸íŠ¸: ë¡œì—´ ë¸”ë£¨ */
            --accent2:      #c8860a;        /* í¬ì¸íŠ¸ ê³¨ë“œ */
            --waiting:      #b06a00;        /* ëŒ€ê¸°ì¤‘: ì•°ë²„ */
        }

        /* â”€â”€ ê¸°ë³¸ ë¦¬ì…‹ â”€â”€ */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 12px;
        }

        /* â”€â”€ ë©”ì¸ ì»¨í…Œì´ë„ˆ â”€â”€ */
        .container {
            max-width: 860px;
            margin: 0 auto;
            background: var(--surface);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(27,58,92,0.15);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           í—¤ë”: ì¢Œìš° 2ë¶„í• 
           ì™¼ìª½ = ì œëª©/ìƒíƒœ  |  ì˜¤ë¥¸ìª½ = ëŒ€ì‚°í•­ ë¯¸ë¦¬ë³´ê¸°
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .header {
            display: grid;
            grid-template-columns: 1fr 200px; /* ì¢Œ: ì œëª© ì˜ì—­ / ìš°: ì§€ë„ ë°•ìŠ¤ */
            gap: 0;
            background: linear-gradient(135deg, var(--navy-dark) 0%, var(--navy) 55%, var(--navy-mid) 100%);
            border-bottom: 2px solid var(--border);
            min-height: 120px;
        }

        /* ì™¼ìª½ ì œëª© ì˜ì—­ */
        .header-left {
            padding: 20px 24px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 6px;
        }
        .header-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            letter-spacing: 3px;
            color: #fff;
            line-height: 1;
            text-shadow: 0 0 20px rgba(88,166,255,0.4);
        }
        .header-sub {
            font-size: 0.75rem;
            color: var(--text-muted);
            letter-spacing: 1px;
            font-weight: 500;
        }
        .header-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 6px;
        }
        /* GAS ì—°ê²° ìƒíƒœ ë±ƒì§€ */
        .conn-badge {
            font-size: 0.68rem;
            padding: 3px 10px;
            border-radius: 20px;
            font-weight: 700;
            letter-spacing: 0.5px;
            border: 1px solid var(--border);
            color: var(--text-muted);
            background: rgba(0,0,0,0.3);
            transition: all 0.4s ease;
        }
        .conn-badge.online {
            border-color: #18a558;
            color: #18a558;
            background: rgba(24,165,88,0.12);
            box-shadow: 0 0 6px rgba(24,165,88,0.2);
        }
        .conn-badge.error {
            border-color: #d63031;
            color: #d63031;
            background: rgba(214,48,49,0.1);
        }
        .created-by {
            font-size: 0.68rem;
            color: var(--text-muted);
        }

        /* ì˜¤ë¥¸ìª½ ëŒ€ì‚°í•­ ì§€ë„ ë°•ìŠ¤ */

        /* ì§€ë„ ë°°ê²½ ê·¸ë¦¬ë“œ (í•­í•´ ì°¨íŠ¸ ëŠë‚Œ) */
        .map-bg-grid {
            position: absolute;
            inset: 0;
            background-image:
                linear-gradient(rgba(88,166,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(88,166,255,0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* í•­êµ¬ ì•„ì´ì½˜ ë° ë ˆì´ë¸” */
        .map-port-icon {
            position: relative;
            z-index: 2;
            text-align: center;
        }
        .map-port-dot {
            width: 14px;
            height: 14px;
            background: var(--accent2);
            border-radius: 50%;
            margin: 0 auto 4px;
            box-shadow: 0 0 0 3px rgba(240,180,41,0.3);
            animation: portPulse 2s ease-in-out infinite;
        }
        @keyframes portPulse {
            0%, 100% { box-shadow: 0 0 0 3px rgba(240,180,41,0.3); }
            50%       { box-shadow: 0 0 0 8px rgba(240,180,41,0.05); }
        }
        .map-port-label {
            font-size: 0.65rem;
            font-weight: 700;
            color: var(--accent2);
            letter-spacing: 1px;
            text-shadow: 0 0 6px rgba(0,0,0,0.8);
        }
        .map-coord {
            position: absolute;
            bottom: 6px;
            left: 0; right: 0;
            text-align: center;
            font-size: 0.55rem;
            color: var(--text-muted);
            font-family: monospace;
        }

        /* í˜¸ë²„ ì˜¤ë²„ë ˆì´ */
        .map-preview-overlay {
            position: absolute;
            inset: 0;
            background: rgba(88,166,255,0.12);
            border: 2px solid rgba(88,166,255,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 3;
        }
        .map-preview-overlay span {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--accent);
            letter-spacing: 1px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* ì„ ë°• ì•„ì´ì½˜ë“¤ (ë°ì½”) */
        .ship-dot {
            position: absolute;
            width: 5px;
            height: 5px;
            background: var(--open);
            border-radius: 50%;
            opacity: 0.7;
        }

        /* â”€â”€ ì›” ë„¤ë¹„ê²Œì´ì…˜ â”€â”€ */
        .month-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            padding: 12px 14px;
            background: var(--surface2);
            border-bottom: 1px solid var(--border);
        }
        .m-btn {
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text-muted);
            padding: 6px 11px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.78rem;
            font-weight: 700;
            font-family: 'Noto Sans KR', sans-serif;
            transition: all 0.2s;
        }
        .m-btn:hover { border-color: var(--accent); color: var(--accent); background: #e3ecfa; }
        .m-btn.active {
            background: var(--navy);
            color: #fff;
            border-color: var(--navy);
            box-shadow: 0 2px 8px rgba(27,58,92,0.25);
        }

        /* â”€â”€ í†µê³„ ë°” â”€â”€ */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            background: var(--surface2);
            border-bottom: 2px solid var(--border);
        }
        .stat-item {
            text-align: center;
            padding: 12px 8px;
            border-right: 1px solid var(--border);
        }
        .stat-item:last-child { border-right: none; }
        .stat-label {
            font-size: 0.68rem;
            color: var(--text-muted);
            font-weight: 700;
            display: block;
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }
        .stat-val {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.6rem;
            letter-spacing: 1px;
        }

        /* â”€â”€ ìº˜ë¦°ë” ê·¸ë¦¬ë“œ â”€â”€ */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: var(--surface);
        }
        .weekday {
            background: var(--navy);
            text-align: center;
            padding: 8px 0;
            font-size: 0.72rem;
            font-weight: 700;
            color: rgba(255,255,255,0.85);
            border-bottom: 1px solid var(--border);
            border-right: 1px solid rgba(255,255,255,0.1);
            letter-spacing: 1px;
        }
        .weekday:last-child { border-right: none; }

        .day-cell {
            border-right: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            min-height: 90px;
            background: var(--surface);
            transition: background 0.15s;
        }
        .day-cell:nth-child(7n+1) { border-left: none; }
        .day-cell:nth-child(7n)   { border-right: none; }

        .day-num {
            font-size: 0.7rem;
            font-weight: 700;
            padding: 5px 6px 2px;
            color: var(--text-muted);
        }

        /* AM/PM ìŠ¬ë¡¯ */
        .slot-container {
            display: flex;
            flex-direction: column;
            gap: 3px;
            padding: 2px 4px 4px;
        }
        .slot {
            flex: 1;
            min-height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.58rem;
            border-radius: 4px;
            font-weight: 700;
            cursor: pointer;
            letter-spacing: 0.5px;
            transition: filter 0.15s, transform 0.1s;
            border: 1px solid transparent;
        }
        .slot:hover { filter: brightness(0.92); transform: scale(1.03); }
        .slot.none         { background: var(--none);               color: #8fa8c0;              border-color: var(--border);            cursor: default; }
        .slot.waiting      { background: #fff3cd;                   color: var(--waiting);       border-color: #f0c040; }
        .slot.open         { background: #d4f5e2;                   color: #0d6e36;              border-color: #7dd6a8; }
        .slot.closed       { background: #fde8e8;                   color: #b01a1a;              border-color: #f5a5a5; }
        .slot.heavy-closed { background: #f5c6c6;                   color: var(--heavy);         border-color: #e07070; font-weight:900; }

        /* â”€â”€ í‘¸í„° â”€â”€ */
        .footer {
            padding: 12px;
            text-align: center;
            font-size: 0.68rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border);
            background: var(--surface2);
        }

        /* â•â• ëª¨ë‹¬ 1: íŒŒê³  ìƒì„¸ â•â• */
        #modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(10,25,50,0.55);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 28px 24px;
            border-radius: 16px;
            text-align: center;
            width: 88%;
            max-width: 300px;
            box-shadow: 0 12px 40px rgba(27,58,92,0.2);
            animation: modalIn 0.2s ease;
        }
        @keyframes modalIn {
            from { transform: scale(0.9); opacity: 0; }
            to   { transform: scale(1);   opacity: 1; }
        }
        .wave-detail-box {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 18px 0;
            padding: 14px;
            background: var(--surface2);
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        .wave-label { font-size: 0.72rem; color: var(--text-muted); margin-bottom: 4px; }
        .wave-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; color: var(--text); }
        .btn-close {
            padding: 9px 22px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--surface2);
            color: var(--text);
            cursor: pointer;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            transition: all 0.2s;
        }
        .btn-close:hover { border-color: var(--navy); color: var(--navy); background: #e3ecfa; }

        /* â•â• ëª¨ë‹¬ 2: MarineTraffic ì§€ë„ â•â• */
        #mapModal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(10,25,50,0.65);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(6px);
        }
        .map-modal-content {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            width: 92vw;
            max-width: 1000px;
            height: 80vh;
            max-height: 680px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(27,58,92,0.3);
            animation: modalIn 0.25s ease;
        }
        .map-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 20px;
            background: var(--navy);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }
        .map-modal-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 2px;
            color: #fff;
        }
        .map-modal-sub {
            font-size: 0.68rem;
            color: rgba(255,255,255,0.6);
            margin-top: 1px;
        }
        .btn-map-close {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: #fff;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .btn-map-close:hover { background: rgba(214,48,49,0.6); border-color: #d63031; }

        .map-iframe-wrapper {
            flex: 1;
            position: relative;
            background: #d8e8f5;
        }
        .map-iframe-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }
        .map-loading {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #ddeaf5;
            gap: 12px;
            z-index: 1;
            pointer-events: none;
        }
        .map-loading.hidden { display: none; }
        .loading-spinner {
            width: 36px;
            height: 36px;
            border: 3px solid var(--border);
            border-top-color: var(--navy);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text {
            font-size: 0.75rem;
            color: var(--text-muted);
            letter-spacing: 1px;
        }

        /* â”€â”€ ë¡œë”© ì˜¤ë²„ë ˆì´ â”€â”€ */
        #loadingOverlay {
            padding: 40px;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
            letter-spacing: 1px;
        }
        .data-spinner {
            width: 28px;
            height: 28px;
            border: 2px solid var(--border);
            border-top-color: var(--navy);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 10px;
        }

        /* â”€â”€ ì—ëŸ¬ ë©”ì‹œì§€ â”€â”€ */
        #errorMsg {
            display: none;
            padding: 20px;
            text-align: center;
            color: var(--closed);
            font-size: 0.82rem;
            background: #fde8e8;
            border: 1px solid #f5a5a5;
            margin: 10px 14px;
            border-radius: 8px;
        }

        /* â”€â”€ ì§€ë„ ë°•ìŠ¤: í•´êµ° ë¸”ë£¨ ê³„ì—´ë¡œ â”€â”€ */
        .header-right {
            position: relative;
            cursor: pointer;
            overflow: hidden;
            border-left: 1px solid rgba(255,255,255,0.15);
            background: #0f2540;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .header-right:hover { background: #162f52; }
        .header-right:hover .map-preview-overlay { opacity: 1; }

        /* â”€â”€ ë°˜ì‘í˜• â”€â”€ */
        @media (max-width: 600px) {
            .header { grid-template-columns: 1fr 130px; }
            .header-title { font-size: 1.4rem; }
            .day-cell { min-height: 72px; }
            .slot { font-size: 0.5rem; min-height: 22px; }
            .map-modal-content { width: 98vw; height: 85vh; }
        }
    </style>
</head>
<body>

<div class="container">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         í—¤ë”: ì¢Œ(ì œëª©) / ìš°(ëŒ€ì‚°í•­ ì§€ë„ ë°•ìŠ¤)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="header">

        <!-- ì™¼ìª½: ì œëª© ì˜ì—­ -->
        <div class="header-left">
            <div class="header-title">ğŸš¢ ëŒ€ì‚°í•­ Seetec í˜„í™©íŒ</div>
            <div class="header-sub">DAESAN PORT Â· WAVE HEIGHT MONITOR Â· 2026</div>
            <div class="header-meta">
                <!-- GAS ì—°ê²° ìƒíƒœ ì‹¤ì‹œê°„ í‘œì‹œ -->
                <span id="connBadge" class="conn-badge">â— ì—°ê²° í™•ì¸ ì¤‘...</span>
                <span class="created-by">Created by JS KIM (LAM)</span>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ëŒ€ì‚°í•­ ë¯¸ë¦¬ë³´ê¸° í´ë¦­ â†’ ì§€ë„ íŒì—… -->
        <div class="header-right" onclick="openMapModal()" title="ëŒ€ì‚°í•­ ì‹¤ì‹œê°„ ì„ ë°• í˜„í™© ë³´ê¸°">
            <!-- í•­í•´ ì°¨íŠ¸ ë°°ê²½ ê·¸ë¦¬ë“œ -->
            <div class="map-bg-grid"></div>

            <!-- ì¥ì‹ìš© ì„ ë°• ë„íŠ¸ë“¤ -->
            <div class="ship-dot" style="top:22%; left:25%;"></div>
            <div class="ship-dot" style="top:55%; left:60%; background:var(--closed);"></div>
            <div class="ship-dot" style="top:35%; left:75%; background:var(--accent);"></div>
            <div class="ship-dot" style="top:70%; left:35%; background:var(--accent2);"></div>
            <div class="ship-dot" style="top:15%; left:55%;"></div>
            <div class="ship-dot" style="top:80%; left:70%;"></div>

            <!-- ì¤‘ì•™ í•­êµ¬ ì•„ì´ì½˜ -->
            <div class="map-port-icon">
                <div class="map-port-dot"></div>
                <div class="map-port-label">ëŒ€ì‚°í•­</div>
            </div>

            <!-- ì¢Œí‘œ í‘œì‹œ -->
            <div class="map-coord">37.02Â°N  126.35Â°E</div>

            <!-- í˜¸ë²„ ì˜¤ë²„ë ˆì´ -->
            <div class="map-preview-overlay">
                <span>ğŸ—ºï¸ ì‹¤ì‹œê°„<br>ì„ ë°• í˜„í™©<br>í´ë¦­í•˜ì—¬ ë³´ê¸°</span>
            </div>
        </div>

    </div><!-- /.header -->

    <!-- â”€â”€ ì›” ë„¤ë¹„ê²Œì´ì…˜ â”€â”€ -->
    <div class="month-nav" id="monthNav"></div>

    <!-- â”€â”€ í†µê³„ ë°” â”€â”€ -->
    <div class="stats-bar">
        <div class="stat-item">
            <span class="stat-label">ğŸŸ¢ ì˜¤í”ˆìœ¨</span>
            <span id="openRatio" class="stat-val" style="color:var(--open)">0%</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">ğŸ”´ í´ë¡œì§• íšŸìˆ˜</span>
            <span id="closedCount" class="stat-val" style="color:var(--closed)">0íšŒ</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">ğŸš« í´ë¡œì§• ë¹„ìœ¨</span>
            <span id="closedRatio" class="stat-val" style="color:var(--closed)">0%</span>
        </div>
    </div>

    <!-- â”€â”€ ì—ëŸ¬ ë©”ì‹œì§€ (GAS ì—°ê²° ì‹¤íŒ¨ ì‹œ í‘œì‹œ) â”€â”€ -->
    <div id="errorMsg">
        âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.
    </div>

    <!-- â”€â”€ ìº˜ë¦°ë” ê·¸ë¦¬ë“œ â”€â”€ -->
    <div class="calendar-grid" id="calendar">
        <!-- ìš”ì¼ í—¤ë” -->
        <div class="weekday">ì¼</div>
        <div class="weekday">ì›”</div>
        <div class="weekday">í™”</div>
        <div class="weekday">ìˆ˜</div>
        <div class="weekday">ëª©</div>
        <div class="weekday">ê¸ˆ</div>
        <div class="weekday">í† </div>
    </div>

    <!-- â”€â”€ ë°ì´í„° ë¡œë”© ì¤‘ í‘œì‹œ â”€â”€ -->
    <div id="loadingOverlay">
        <div class="data-spinner"></div>
        ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
    </div>

    <!-- â”€â”€ í‘¸í„° â”€â”€ -->
    <div class="footer">
        Â© 2026 LAM Advanced Procurement. All port data verified for Daesan Seetec Terminal.
    </div>

</div><!-- /.container -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ëª¨ë‹¬ 1: íŒŒê³  ìƒì„¸ ì •ë³´
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="modal" onclick="closeDetailModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div id="mDate" style="font-weight:700; margin-bottom:6px; color:var(--text-muted); font-size:0.85rem;"></div>
        <div id="mStatus" style="font-weight:900; font-size:1.25rem; margin-bottom:2px;"></div>
        <div class="wave-detail-box" id="waveBox">
            <div>
                <div class="wave-label">ìµœì € íŒŒê³  (Min)</div>
                <div id="mLow" class="wave-value">-</div>
            </div>
            <div>
                <div class="wave-label">ìµœê³  íŒŒê³  (Max)</div>
                <div id="mHigh" class="wave-value">-</div>
            </div>
        </div>
        <button class="btn-close" onclick="closeDetailModal()">ì°½ ë‹«ê¸°</button>
    </div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ëª¨ë‹¬ 2: MarineTraffic ëŒ€ì‚°í•­ ì‹¤ì‹œê°„ ì§€ë„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="mapModal" onclick="closeMapModal()">
    <div class="map-modal-content" onclick="event.stopPropagation()">

        <!-- ì§€ë„ ëª¨ë‹¬ í—¤ë” -->
        <div class="map-modal-header">
            <div>
                <div class="map-modal-title">ğŸ—ºï¸ ëŒ€ì‚°í•­ ì‹¤ì‹œê°„ ì„ ë°• í˜„í™©</div>
                <div class="map-modal-sub">MarineTraffic AIS Â· 37.02Â°N 126.35Â°E Â· Daesan Port</div>
            </div>
            <button class="btn-map-close" onclick="closeMapModal()">âœ•</button>
        </div>

        <!-- iframe ë˜í¼ -->
        <div class="map-iframe-wrapper">
            <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ (iframe ë¡œë“œ ì™„ë£Œ ì „) -->
            <div class="map-loading" id="mapLoading">
                <div class="loading-spinner"></div>
                <div class="loading-text">ì§€ë„ ë¡œë”© ì¤‘...</div>
            </div>
            <!-- MarineTraffic iframe: ëŒ€ì‚°í•­ ì¢Œí‘œ ê³ ì • -->
            <iframe
                id="shipFrame"
                src=""
                data-src="https://www.marinetraffic.com/en/ais/embed/zoom:13/centery:37.0175/centerx:126.3542/shownames:true/"
                allowfullscreen
                onload="onIframeLoad()"
                title="ëŒ€ì‚°í•­ ì‹¤ì‹œê°„ ì„ ë°• AIS">
            </iframe>
        </div>

    </div>
</div>


<script>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ì„¤ì •ê°’
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    const YEAR = 2026;                     // í‘œì‹œ ì—°ë„

    // â˜…â˜…â˜… GAS Web App URL â˜…â˜…â˜…
    // Code.gs ë°°í¬ í›„ ì•„ë˜ URLì„ êµì²´í•˜ì„¸ìš”
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzLD2zu_d5fGBfruTV8IYS6FeGbI9x2t5ONinY4UvUJOqL2f8K4_7FVL5LokHp3N7b6/exec";

    let currentMonth = new Date().getMonth() + 1;   // í˜„ì¬ ì›” (ê¸°ë³¸)
    let globalData   = {};                           // ì „ì²´ íŒŒì‹±ëœ ë°ì´í„°

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ì´ˆê¸°í™”
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function init() {
        buildMonthNav();   // ì›” ë²„íŠ¼ ìƒì„±
        fetchGasData();    // GASì—ì„œ ë°ì´í„° ë¡œë“œ
    }

    /* â”€â”€ ì›” ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ìƒì„± â”€â”€ */
    function buildMonthNav() {
        const nav = document.getElementById('monthNav');
        nav.innerHTML = '';
        for (let m = 1; m <= 12; m++) {
            const btn = document.createElement('button');
            btn.className = `m-btn ${m === currentMonth ? 'active' : ''}`;
            btn.innerText  = `${m}ì›”`;
            btn.onclick = () => {
                document.querySelectorAll('.m-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentMonth = m;
                renderCalendar(m);
            };
            nav.appendChild(btn);
        }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GAS ë°ì´í„° fetch
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    async function fetchGasData() {
        const badge   = document.getElementById('connBadge');
        const loading = document.getElementById('loadingOverlay');
        const errMsg  = document.getElementById('errorMsg');

        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        badge.className  = 'conn-badge';
        badge.innerText  = 'â— ì—°ê²° ì¤‘...';
        loading.style.display = 'block';
        errMsg.style.display  = 'none';

        try {
            // GAS Web App GET ìš”ì²­ (JSON ë°˜í™˜)
            const res  = await fetch(GAS_URL + "?action=getData", { cache: "no-store" });
            const json = await res.json();

            if (!json || !json.data) throw new Error('ì‘ë‹µ ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜');

            parseGasJson(json.data);   // ë°ì´í„° íŒŒì‹±

            // ì—°ê²° ì„±ê³µ ì²˜ë¦¬
            badge.className = 'conn-badge online';
            badge.innerText = 'â— ì˜¨ë¼ì¸ ì—°ê²° ì„±ê³µ';
            loading.style.display = 'none';
            renderCalendar(currentMonth);

        } catch (err) {
            console.error('[GAS ì—°ê²° ì˜¤ë¥˜]', err);

            // ì—°ê²° ì‹¤íŒ¨ ì²˜ë¦¬
            badge.className = 'conn-badge error';
            badge.innerText = 'â— ì—°ê²° ì‹¤íŒ¨';
            loading.style.display = 'none';
            errMsg.style.display  = 'block';
        }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GAS JSON íŒŒì‹±
       GASì—ì„œ ë°˜í™˜í•˜ëŠ” í˜•ì‹:
       { data: [ {date, time, low, high, status}, ... ] }
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function parseGasJson(rows) {
        globalData = {};
        rows.forEach(row => {
            const date = (row.date || '').trim();
            if (!date) return;
            if (!globalData[date]) globalData[date] = [];
            globalData[date].push({
                t:    (row.time   || '').trim(),
                low:  (row.low    || '').toString().trim(),
                high: (row.high   || '').toString().trim(),
                s:    (row.status || '').trim()
            });
        });
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ìº˜ë¦°ë” ë Œë”ë§
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function renderCalendar(month) {
        const grid = document.getElementById('calendar');

        // ê¸°ì¡´ ë‚ ì§œ ì…€ë§Œ ì œê±° (ìš”ì¼ í—¤ë”ëŠ” ìœ ì§€)
        grid.querySelectorAll('.day-cell').forEach(c => c.remove());

        const firstDay    = new Date(YEAR, month - 1, 1).getDay();  // 1ì¼ì˜ ìš”ì¼
        const daysInMonth = new Date(YEAR, month, 0).getDate();      // í•´ë‹¹ì›” ì´ ì¼ìˆ˜

        let total = 0, openCnt = 0, closedCnt = 0;

        // 1ì¼ ì• ë¹ˆ ì…€
        for (let i = 0; i < firstDay; i++) {
            const empty = document.createElement('div');
            empty.className = 'day-cell';
            empty.style.background = 'rgba(0,0,0,0.2)';
            grid.appendChild(empty);
        }

        // ë‚ ì§œë³„ ì…€ ìƒì„±
        for (let d = 1; d <= daysInMonth; d++) {
            const dateStr = `${YEAR}-${String(month).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const records = globalData[dateStr] || [];

            // ë‚ ì§œ ì…€ ìƒì„±
            const cell = document.createElement('div');
            cell.className = 'day-cell';

            // ë‚ ì§œ ë²ˆí˜¸
            const numDiv = document.createElement('div');
            numDiv.className = 'day-num';
            numDiv.innerText = d;
            cell.appendChild(numDiv);

            // AM/PM ìŠ¬ë¡¯ ì»¨í…Œì´ë„ˆ
            const slotCon = document.createElement('div');
            slotCon.className = 'slot-container';

            // ì˜¤ì „/ì˜¤í›„ ìŠ¬ë¡¯ ì²˜ë¦¬
            [{ k: 'ì˜¤ì „', l: 'AM' }, { k: 'ì˜¤í›„', l: 'PM' }].forEach(period => {
                const rec    = records.find(r => r.t.includes(period.k));
                const slotEl = document.createElement('div');

                if (rec) {
                    const status  = rec.s.trim();
                    const highVal = parseFloat(String(rec.high).replace(/[^0-9.]/g, ''));
                    // ë¹ˆê°’(""), ë°œí‘œëŒ€ê¸°ì¤‘, NaN ëª¨ë‘ ëŒ€ê¸°ì¤‘ìœ¼ë¡œ ì²˜ë¦¬
                    const isWait  = !status || status === 'ë°œí‘œëŒ€ê¸°ì¤‘' || isNaN(highVal) || rec.high === '' || rec.low === '';

                    if (!isWait) {
                        total++;
                        if (status.toLowerCase() === 'closed') closedCnt++;
                        else openCnt++;
                    }

                    // ìŠ¬ë¡¯ ìƒíƒœë³„ CSS í´ë˜ìŠ¤ ê²°ì •
                    let sClass = 'none';
                    let icon   = '---';

                    if (isWait) {
                        sClass = 'waiting';
                        icon   = `â³ ${period.l}`;
                    } else if (status.toLowerCase() === 'closed') {
                        sClass = (highVal >= 4.0) ? 'heavy-closed' : 'closed';
                        icon   = `ğŸ”´ ${period.l}`;
                    } else {
                        sClass = 'open';
                        icon   = `ğŸŸ¢ ${period.l}`;
                    }

                    slotEl.className = `slot ${sClass}`;
                    slotEl.innerText = icon;

                    // í´ë¦­ â†’ íŒŒê³  ìƒì„¸ ëª¨ë‹¬ (ëŒ€ê¸°ì¤‘ ì œì™¸)
                    if (!isWait) {
                        slotEl.onclick = () => showDetail(dateStr, rec.t, rec.low, rec.high, status);
                    }

                } else {
                    // ë°ì´í„° ì—†ìŒ
                    slotEl.className = 'slot none';
                    slotEl.innerText = '---';
                }

                slotCon.appendChild(slotEl);
            });

            cell.appendChild(slotCon);
            grid.appendChild(cell);
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        updateStats(total, openCnt, closedCnt);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       í†µê³„ ë°” ì—…ë°ì´íŠ¸
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function updateStats(t, o, c) {
        const ratio = t > 0 ? Math.round((o / t) * 100) : 0;
        document.getElementById('openRatio').innerText   = ratio + '%';
        document.getElementById('closedCount').innerText = c + 'íšŒ';
        document.getElementById('closedRatio').innerText = (t > 0 ? (100 - ratio) : 0) + '%';
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       íŒŒê³  ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function showDetail(d, t, low, high, s) {
        document.getElementById('mDate').innerText = `${d}  (${t})`;

        const status  = s.trim();
        const highVal = parseFloat(String(high).replace(/[^0-9.]/g, ''));
        const isClosed = status.toLowerCase() === 'closed';
        const isHeavy  = highVal >= 4.0;

        // ìƒíƒœ í…ìŠ¤íŠ¸ & ìƒ‰ìƒ
        const statusEl = document.getElementById('mStatus');
        if (isClosed && isHeavy) {
            statusEl.innerText   = 'ğŸš¨ HEAVY CLOSED';
            statusEl.style.color = 'var(--heavy)';
        } else if (isClosed) {
            statusEl.innerText   = 'ğŸ”´ PORT CLOSED';
            statusEl.style.color = 'var(--closed)';
        } else {
            statusEl.innerText   = 'ğŸŸ¢ PORT OPEN';
            statusEl.style.color = 'var(--open)';
        }

        // íŒŒê³  ìˆ˜ì¹˜ (ë‹¨ìœ„ m ë³´ì •)
        const fmt = v => v && !String(v).includes('m') ? v + 'm' : v || '-';
        document.getElementById('mLow').innerText  = fmt(low);
        document.getElementById('mHigh').innerText = fmt(high);

        document.getElementById('modal').style.display = 'flex';
    }

    /* â”€â”€ íŒŒê³  ëª¨ë‹¬ ë‹«ê¸° â”€â”€ */
    function closeDetailModal() {
        document.getElementById('modal').style.display = 'none';
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MarineTraffic ì§€ë„ ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function openMapModal() {
        const modal   = document.getElementById('mapModal');
        const iframe  = document.getElementById('shipFrame');
        const loading = document.getElementById('mapLoading');

        // iframe srcê°€ ë¹„ì–´ ìˆìœ¼ë©´ ì´ì œ ë¡œë“œ (ì§€ì—° ë¡œë”©: ì²˜ìŒ í´ë¦­ ì‹œë§Œ)
        if (!iframe.src || iframe.src === window.location.href) {
            loading.classList.remove('hidden');
            iframe.src = iframe.dataset.src;   // data-src â†’ srcë¡œ ì „í™˜
        }

        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';  // ìŠ¤í¬ë¡¤ ì ê¸ˆ
    }

    /* â”€â”€ iframe ë¡œë“œ ì™„ë£Œ â†’ ìŠ¤í”¼ë„ˆ ìˆ¨ê¹€ â”€â”€ */
    function onIframeLoad() {
        document.getElementById('mapLoading').classList.add('hidden');
    }

    /* â”€â”€ ì§€ë„ ëª¨ë‹¬ ë‹«ê¸° â”€â”€ */
    function closeMapModal() {
        document.getElementById('mapModal').style.display = 'none';
        document.body.style.overflow = '';         // ìŠ¤í¬ë¡¤ ë³µì›
    }

    /* â”€â”€ ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸° â”€â”€ */
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
            closeDetailModal();
            closeMapModal();
        }
    });

    /* â”€â”€ í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” â”€â”€ */
    window.onload = init;
</script>

</body>
</html>
